{"version":3,"sources":["editor-polyline.js","ajax.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"editor-polyline.js","sourcesContent":["var markers = [],polylineStore = [];\r\nvar polyline,datapostgis ='';\r\nvar id = \"points\";\r\nvar start ='li_start',stop = 'li_stop',clear = 'li_clear',save = 'li_save';\r\nvar drawingmode = false;\r\nvar path = [];\r\nvar mapMinZoom = 12;\r\nvar mapMaxZoom = 18;\r\nvar google;\r\n\r\nfunction initEditPolyline(map) {\r\n    var div = document.createElement('div');\r\n    div.id = 'aksi-editor';\r\n    div.className = 'btn-group';\r\n    var buttontext = document.createElement('button');\r\n    buttontext.className = 'btn btn-default';\r\n    buttontext.textContent = 'Edit';\r\n    buttontext.type = 'button';\r\n    div.appendChild(buttontext);\r\n    var buttonToggle = document.createElement('button');\r\n    buttonToggle.className = 'btn btn-default btn-flat dropdown-toggle';\r\n    buttonToggle.type = 'button';\r\n    buttonToggle.dataset.toggle = 'dropdown';\r\n    buttonToggle.innerHTML = '<i class=\"caret\"></i>&nbsp;';\r\n    div.appendChild(buttonToggle);\r\n\r\n    var ul = document.createElement('ul');\r\n    ul.className = 'dropdown-menu icons-right dropdown-menu-right';\r\n    var _start = document.createElement('li');\r\n    _start.id = 'li_start';\r\n        var a_start = document.createElement('a');\r\n        a_start.textContent = 'Mulai Edit';\r\n        a_start.href = '#';\r\n        var _this = this;\r\n        a_start.addEventListener(\"click\", function(e){\r\n            console.log(window);\r\n            window.startEditing();\r\n        });\r\n        _start.appendChild(a_start);\r\n    ul.appendChild(_start);\r\n\r\n    var _stop = document.createElement('li');\r\n    _stop.id = 'li_stop';\r\n    _stop.className = 'disabled';\r\n        var a_stop = document.createElement('a');\r\n        a_stop.textContent = 'Berhenti Edit';\r\n        a_stop.href = '#';\r\n        _stop.appendChild(a_stop);\r\n        a_stop.addEventListener(\"click\", function(e){\r\n            console.log(window);\r\n            window.stopEditing();\r\n        });\r\n    ul.appendChild(_stop);\r\n\r\n    var _clear = document.createElement('li');\r\n    _clear.id = 'li_clear';\r\n    _clear.className = 'disabled';\r\n        var a_clear = document.createElement('a');\r\n        a_clear.textContent = 'Hilangkan';\r\n        a_clear.href = '#';\r\n        _clear.appendChild(a_clear);\r\n        a_clear.addEventListener(\"click\", function(e){\r\n            console.log(window);\r\n            window.clearEditing();\r\n        });\r\n        \r\n    ul.appendChild(_clear);\r\n\r\n    var _save = document.createElement('li');\r\n    _save.id = 'li_save';\r\n    _save.className = 'disabled';\r\n        var a_save = document.createElement('a');\r\n        a_save.id = \"save\";\r\n        a_save.textContent = 'Simpan';\r\n        a_save.href = '#';\r\n        _save.appendChild(a_save);\r\n    ul.appendChild(_save);\r\n\r\n    div.appendChild(ul);\r\n\r\n    var aksieditor = document.getElementById('tools');\r\n    aksieditor.appendChild(div);\r\n    map.controls[google.maps.ControlPosition.RIGHT_TOP].push(aksieditor);\r\n    google.maps.event.addListener(map, 'click', function(event) {\r\n        if(drawingmode){\r\n            addMarker(event.latLng);\r\n            displayMarkers();\r\n        }\r\n    });\r\n    var txt = document.getElementById(id);\r\n    if (txt.value !== null) {\r\n        setMarkers();\r\n    }\r\n\r\n}\r\n\r\nfunction startEditing(){\r\n    document.getElementById(start).classList.add('disabled');\r\n    document.getElementById(stop).classList.remove('disabled');\r\n    document.getElementById(clear).classList.remove('disabled');\r\n    document.getElementById(save).classList.remove('disabled');\r\n\r\n    drawingmode = true;\r\n}\r\n\r\nfunction stopEditing(){\r\n    drawingmode = false;\r\n    document.getElementById(start).classList.remove('disabled');\r\n    document.getElementById(stop).classList.add('disabled');\r\n    document.getElementById(clear).classList.add('disabled');\r\n    document.getElementById(save).classList.add('disabled');\r\n}\r\n\r\nfunction clearEditing(){\r\n    clearMarkers();\r\n}\r\n\r\nfunction showPolyline() {\r\n    if (polyline) {\r\n        polyline.setMap(null);\r\n    }\r\n    path = [];\r\n    for (var i = 0; i < markers.length; i++) {\r\n        var latlng = markers[i].getPosition();\r\n        path.push(latlng);\r\n        markers[i].setTitle(\"#\" + i + \": \" + latlng.toUrlValue());\r\n    }\r\n    polyline = new google.maps.Polyline({\r\n        map: map,\r\n        path: path,\r\n        strokeColor: \"#0000FF\",\r\n        strokeOpacity: 0.5,\r\n        strokeWeight: 5,\r\n    });\r\n}\r\n\r\nfunction clearMarkers() {\r\n    var txt = document.getElementById(id);\r\n    txt.value = '';\r\n    for (var i = 0; i < markers.length; i++) {\r\n        markers[i].setMap(null);\r\n    }\r\n    markers = [];\r\n    polylineStore = [];\r\n    showPolyline();\r\n}\r\n\r\nfunction getMarkerIndex(marker) {\r\n    for (var i = 0; i < markers.length; i++) {\r\n        if (marker == markers[i]) {\r\n            return i;\r\n        }\r\n    }\r\n    return -1;\r\n}\r\n\r\nfunction addMarker(latlng, i) {\r\n    var host = 'http://localhost/';\r\n    var marker = new google.maps.Marker({\r\n        map: map,\r\n        position: latlng,\r\n        draggable: true,\r\n        //icon: host+'images/maps/waterpark.png'\r\n    });\r\n\r\n    /*\r\n    google.maps.event.addListener(marker, 'click', function() {\r\n            var infoWindow = new google.maps.InfoWindow({\r\n                    content: marker.getPosition().toUrlValue(),\r\n                });\r\n            infoWindow.open(map, marker);\r\n        });\r\n    */\r\n\r\n    google.maps.event.addListener(marker, 'dragend', function(event) {\r\n        if(drawingmode){\r\n\r\n            showPolyline();\r\n            displayMarkers();\r\n        }\r\n    });\r\n    google.maps.event.addListener(marker, 'rightclick', function(event) {\r\n        if(drawingmode){\r\n            removeMarker(marker);\r\n            showPolyline();\r\n            displayMarkers();\r\n        }\r\n    });\r\n    google.maps.event.addListener(marker, 'dblclick', function(event) {\r\n        if(drawingmode){\r\n        var i = getMarkerIndex(marker);\r\n        if (i > 0 && i == markers.length - 1) {\r\n            i--;\r\n        }\r\n        if (i < markers.length - 1) {\r\n            var lat0 = markers[i].getPosition().lat();\r\n            var lng0 = markers[i].getPosition().lng();\r\n            var lat1 = markers[i+1].getPosition().lat();\r\n            var lng1 = markers[i+1].getPosition().lng();\r\n            var latlng = new google.maps.LatLng((lat0+lat1)/2, (lng0+lng1)/2);\r\n            addMarker(latlng, i+1);\r\n        }\r\n        }\r\n    });\r\n    if (i == null || i >= markers.length) {\r\n        markers.push(marker);\r\n    } else {\r\n        markers.splice(i, 0, marker);\r\n    }\r\n    showPolyline();\r\n}\r\n\r\nfunction removeMarker(marker) {\r\n    var i = getMarkerIndex(marker);\r\n    marker.setMap(null);\r\n    markers.splice(i, 1);\r\n    showPolyline();\r\n}\r\n\r\nfunction displayMarkers() {\r\n    var txt = document.getElementById(id);\r\n    txt.value = \"\";\r\n    polylineStore = [];\r\n    datapostgis = \"\";\r\n    var countjson = markers.length;\r\n\t\tvar last_index = countjson - 1;\r\n    for (var i = 0; i < markers.length; i++) {\r\n        var latlng = markers[i].getPosition();\r\n        txt.value += latlng.toUrlValue() + \",\\n\";\r\n        /*console.log(markers[i]);\r\n        var comma = (i == last_index) ? \"\" : \",\\n\" ;\r\n        datapostgis += markers[i].lng+\" \"+markers[i].lat+\"\"+comma;*/\r\n        polylineStore.push(latlng.toJSON());\r\n        //console.log(polylineStore);\r\n    }\r\n}\r\n\r\nfunction setMarkers() {\r\n    var txt = document.getElementById(id);\r\n    var lines = txt.value.split(/\\n/);\r\n    //console.log(lines);\r\n    clearMarkers();\r\n    for (var i in lines) {\r\n        var ps = lines[i].split(/,/);\r\n\r\n        if (ps.length >= 2) {\r\n            var latlng = new google.maps.LatLng(ps[0], ps[1]);\r\n            addMarker(latlng);\r\n        }\r\n    }\r\n    displayMarkers();\r\n    if (markers.length > 0) {\r\n        map.setCenter(markers[0].getPosition());\r\n    }\r\n}\r\n","function xhr_get(url) {\r\n\r\n  return $.ajax({\r\n    url: url,\r\n    type: 'get',\r\n    dataType: 'json'\r\n  })\r\n  .pipe(function(data) {\r\n\r\n    return data.responseCode != 200 ? $.Deferred().reject( data ) : data;\r\n  })\r\n  .fail(function(data) {\r\n    if ( data.responseCode )\r\n\r\n      console.log( data.responseCode );\r\n  });\r\n}\r\n\r\nfunction xhr_post(url,data) {\r\n\r\n  return $.ajax({\r\n    url: url,\r\n    type: 'post',\r\n    dataType: 'json',\r\n    data: data,\r\n  })\r\n  .pipe(function(data) {\r\n    $('#statussave').html('Data berhasil disimpan');\r\n    setInterval(function() {\r\n      $('#statussave').html('');\r\n    }, 3000);\r\n    return data.responseCode != 200 ?\r\n      $.Deferred().reject( data ) : data;\r\n  })\r\n  .fail(function(data) {\r\n\r\n    if ( data.responseCode )\r\n      $('#statussave').html('Data berhasil tidak disimpan');\r\n      setInterval(function() {\r\n        $('#statussave').html('');\r\n      }, 3000);\r\n      console.log( data.responseCode );\r\n  }).then(function(data){\r\n    window.location = '/home';\r\n  });\r\n}\r\n"]}